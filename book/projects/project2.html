
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project 2 &#8212; FYS3150/FYS4150 course material</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Project 3" href="project3.html" />
    <link rel="prev" title="Project 1" href="project1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">FYS3150/FYS4150 course material</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting ready
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_ready/windows_users.html">
   Windows users
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_ready/mac_users.html">
   Mac users
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_ready/linux_users.html">
   Linux users
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Using the terminal
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../using_the_terminal/basics.html">
   Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_the_terminal/keyboard_shortcuts.html">
   Keyboard shortcuts
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Using git and GitHub
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/introduction_to_git.html">
   Introduction to git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/setting_up_git_and_a_GitHub_repo.html">
   Setting up git and GitHub repo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/add_a_README.html">
   Add a README
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/using_git.html">
   Using git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/dealing_with_merge_conflicts.html">
   Dealing with merge conflicts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/recover_an_old_version_of_a_file.html">
   Recover an old version of a file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../using_git/other_ways_to_fix_mistakes.html">
   Other ways to fix mistakes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to C++
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/intro.html">
   Intro
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/hello_world.html">
   Hello World
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/compiling_and_linking_take_1.html">
   Compiling and linking, take 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/source_files_and_header_files.html">
   Source files and header files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/variables.html">
   Variables
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/functions_take_1.html">
   Functions, take 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/read_command_line_input.html">
   Read command line input
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/write_to_file.html">
   Write to file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/read_from_file.html">
   Read from file
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/if_else.html">
   If else
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/loops.html">
   Loops
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/containers.html">
   Containers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/intro_to_armadillo.html">
   Introduction to Armadillo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/pointers.html">
   Pointers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/classes.html">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction_to_cpp/online_resources.html">
   Online C++ resources
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../optimization/memory_is_the_bottleneck.html">
   Memory traffic is the bottleneck
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Parallelization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../parallelization/introduction_to_openmp.html">
   Introduction to OpenMP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../parallelization/using_openmp.html">
   Using OpenMP
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Using Make
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../using_make/intro.html">
   Intro
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Writing reports
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../writing_reports/introduction_to_latex.html">
   Introduction to LaTeX
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../writing_reports/checklist.html">
   Checklist for reports
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Projects
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="project1.html">
   Project 1
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Project 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project3.html">
   Project 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project4.html">
   Project 4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project5.html">
   Project 5
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/book/projects/project2.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/anderkve/FYS3150"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/anderkve/FYS3150/issues/new?title=Issue%20on%20page%20%2Fbook/projects/project2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Project 2</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="project-2">
<h1>Project 2<a class="headerlink" href="#project-2" title="Permalink to this headline">¶</a></h1>
<p>This project is not published yet.</p>
<!-- 
## Practicalities

- **Deadline**: Monday, September 27, 23:59.
- **Format:** 
  - A pdf document, typeset in LaTeX, with answers to all the problems below. You deliver the pdf on Canvas.
  - Code (with comments, of course) on a GitHub repo, with the repo link provided in the pdf documentet.
  - You *must* deliver via your group on Canvas (even if you are working alone).

- **Not a complete report:** For project 2 we do not require you to write a proper scientific report --- only a document with an answer for each problem. But the quality of the presentation still matters, of course. So pay attention to figures, figure captions, grammar, etc.

- **Collaboration:** We *strongly* encourage you to collaborate with others, in groups up to four students. The group hands in a single pdf. Remember to list everyone's name in the pdf.

- **Reproducibility:** Your code should be available on a GitHub repo. You can refer to relevant parts of your code in your answers. Make sure to include a README file in the repo that briefly explains how the code is organized, and how it should be compiled and run in order to reproduce your results.

- **Figures:** Figures included in your LaTeX document should be made as vector graphics (e.g. `.pdf` files), rather than raster graphics (e.g. `.png` files). If you are making plots with `matplotlib.pyplot` in Python, this is as simple as calling `plt.savefig("figure.pdf")` rather than `plt.savefig("figure.png")`.

- **We recommend using Armadillo:** For this project we recommend using Armadillo to work with matrices and vectors.


## Introduction

The main topics of this project are 

- scaling of equations
- eigenvalue problems
- code testing (*unit testing*).

Our example of an eigenvalue problem is a special case of a one-dimensional buckling beam. Consider the following situation:

- A horizontal beam of length $L$.
- We let $u(x)$ be the vertical displacement of the beam at horizontal position $x$, with $x \in [0,L]$.
- A force $F$ is applied at the endpoint ($x=L$), *directed into the beam*, i.e. towards $x=0$. 
- The beam is fastened with *pin endpoints*, meaning that $u(0)=0$ and $u(L)=0$, but the endpoints are allowed to rotate ($u'(x) \neq 0$).
- We are *not* studying a time-dependent system here -- we are simply interested in the different static shapes the beam can take due to the applied force.

We can then describe this situation with the second-order differential equation

$$ 
\gamma \frac{d^2 u(x)}{dx^2} = - F u(x),
$$ (bb_eq_1)

where $\gamma$ is some constant defined by material properties like rigidity. However, the equation we will actually be working with is the scaled equation

$$ 
\frac{d^2 u(\hat{x})}{d\hat{x}^2} = - \lambda u(\hat{x}),
$$ (bb_eq_2)

where $\hat{x} \equiv x/L$ is a dimensionless (unitless) varible, $\hat{x} \in [0,1]$, and $\lambda = \frac{F L^2}{\gamma}$. (See problem 1.)

----
**Discretization:** We discretize this by dividing our $\hat{x}$ range into $n$ parts, i.e. we will have $n+1$ points $\hat{x}_0$, $\hat{x}_1$, $\ldots$, $\hat{x}_{n-1}$, $\hat{x}_{n}$. Thus we have a stepsize 

$$
h = \frac{\hat{x}_{\text{max}} - \hat{x}_{\text{min}}}{n} = \frac{1 - 0}{n} = \frac{1}{n}
$$

and our $\hat{x}_i$ points are given by 

$$
\hat{x}_i = \hat{x}_0 + ih, \quad i=0,1,\ldots,n.
$$

From this dicretization we get the following set of equations for $v_i$ (our approximations to the exact $u_i$):

$$
\frac{-v_{i+1} + 2v_i -v_{i-1}}{h^2} = \lambda v_i.
$$

By inserting the boundary conditions $v_0=0$ and $v_n=0$ we can write this as the linear algebra eigenvalue problem 

$$
\mathbf{A} \vec{v} = \lambda \vec{v}
$$ (bb_eq_3)

where 
- the elements of the vector $\vec{v}$ are $\vec{v} = [v_1, \ldots, v_{n-1}]$; and 
- $\mathbf{A}$ is tridiag($a$, $d$, $a$), with 
  - $a = -1/h^2$
  - $d = 2/h^2$ 
- *Note:* In contrast to project 1, we here keep the factor $1/h^2$ as part of the definition of $\mathbf{A}$.

To solve this matrix equation means finding the pairs of eigenvalues and eigenvectors, ($\lambda^{(i)}, \vec{v}^{(i)}$), that satify Eq. {eq}`bb_eq_3`. These eigenvectors are then our discretized approximations to the true *eigenfunctions* $u^{(i)}(\hat{x})$ that are the solutions of the differential equation in Eq. {eq}`bb_eq_2`.

-----

**Notation:** We will use $N$ to denote the size of the matrix, so that $\mathbf{A}$ is an $N \times N$ matrix, and $\vec{v}$ a column vector of length $N$. Make sure not to confuse $N$ with the number of *steps* in our discretization of $\hat{x}$ ($n$ steps), or the number of $\hat{x}_i$ points ($n+1$ points). They are related as $N = n-1$.

-----
**Analytical solutions:** For a given matrix size $N \times N$, the eigenvalue problem in Eq. {eq}`bb_eq_3` with the tridiagonal matrix $\mathbf{A} = \text{tridiag}(a,d,a)$ has the following set of analytical eigenvalues and eigenvectors:

$$
\lambda^{(i)} = d + 2 a \cos\left(\frac{i \pi}{N+1}\right), \quad i = 1,\ldots,N
$$

$$
\vec{v}^{(i)} = \left[\sin\left(\frac{i \pi}{N+1}\right), \sin\left(\frac{2 i \pi}{N+1}\right), \ldots, \sin\left(\frac{N i \pi}{N+1}\right)\right]^T,\quad i = 1,\ldots,N
$$

----
**Scaling of eigenvectors:** Remember that if $\vec{v}$ is an eigenvector of $\mathbf{A} \vec{v} = \lambda \vec{v}$, then a scaled vector $c \vec{v}$ (where $c$ is some constant) is an equally good eigenvector. When presenting your results, and when comparing to results from Armadillo, it will be useful to scale each eigenvector to have unit norm (i.e. vector length 1). You can do this easily using the Armadillo function `arma::normalise` described [here](http://arma.sourceforge.net/docs.html#normalise).


## Problems

### Problem 1
With the definition $\hat{x} \equiv x/L$, show that Eq. {eq}`bb_eq_1` can be written as Eq. {eq}`bb_eq_2`.


### Problem 2
Jacobi's rotation algorithm is based on an important property of orthogonal transformations that we will show here. Assume that 

- $\vec{v}_i$ is a set of *orthonormal* basis vectors, i.e. that $\vec{v}_i^T \cdot \vec{v}_j = \delta_{ij}$.
- $\mathbf{U}$ is an *orthogonal* transformation matrix, i.e. that $\mathbf{U}^T = \mathbf{U}^{-1}$.

Show that transformations with $\mathbf{U}$ preserves orthonormality, i.e. show that the set of vectors $\vec{w}_i = \mathbf{U} \vec{v}_i$ is also an orthonormal set.


### Problem 3
Before we get started with implementing the Jacobi rotation algorithm, let's make sure that we can set up the tridiagonal matrix $\mathbf{A}$ correctly. So, write a short program that:

- sets up the tridiagonal $\mathbf{A}$ for $N=6$;
- solves $\mathbf{A} \vec{v} = \lambda \vec{v}$ using Armadillo's `arma::eig_sym`, described [here](http://arma.sourceforge.net/docs.html#eig_sym);
- checks that the eigenvalues and eigenvectors from Armadillo agrees with the analytical result for $N=6$. (Remember scaling of eigenvectors, as discussed above.)


### Problem 4
An important part of the Jacobi algorithm is to have a function that can identify the largest (in absolute value) off-diagonal element of a matrix. Here we specialize to the case of a *symmetric* matrix. 

**a)** Write a C++ function that can identify the largest off-diagonal element of a matrix. A suggestion is to write a function that 

- has return type `double`
- takes an Armadillo matrix as input
- takes *references* to two integers as input
- identifies the largest off-diagonal element in the matrix (under the assumption of a symmetric matrix)
- writes the matrix indices for this element to the two integer references
- returns the value of this matrix element

A simple function signature could then be 

```c
double max_offdiag_symmetric(arma::mat A, int& k, int &l),
```

Or, to avoid copying the (potentially large) matrix A every time we run the function, we could simply pass in a reference to A. Since the function `max_offdiag_symmetric` won't be modifying the matrix in any way, we should make this explicit by using a `const` reference, like this:

```c
double max_offdiag_symmetric(const arma::mat& A, int& k, int &l)
```

**b)** Write a small test code that tests the above function using the matrix

$$
A = 
\begin{bmatrix}
1 & 0 & 0 & 0.5\\
0 & 1 & -0.7 & 0\\
0 & -0.7 & 1 & 0\\
0.5 & 0 & 0 & 1
\end{bmatrix}
$$



### Problem 5
**a)** Write a code implementation of Jacobi's rotation algorithm for solving Eq. {eq}`bb_eq_3`. See the code snippets at the end of this page for a suggested code structure.

**b)** Let $\mathbf{A}$ be of size $6 \times 6$. Test your code by checking that the eigenvalues and eigenvectors you get agree with the analytical results for $N=6$.


### Problem 6
Now let's look at how many similarity transformations we need before we reach a result where all non-diagonal matrix elements are close to zero. 

**a)** Try to estimate how the number of required transformations scale with the matrix size $N$ for your code when solving Eq. {eq}`bb_eq_3`. Present your scaling data either in a table or a plot (or both).

**b)** What scaling behaviour would you expect to see if $\mathbf{A}$ was a dense matrix?

**First hint:** Think about the result you got in problem a). Why is it that the algorithm is so slow, even when starting with a matrix with so many zero elements? 

**Second hint:** While you're not required to do so, there's of course nothing stopping you from just testing the case in b) with your Jacobi code! Here's a quick way to generate a N*N dense and symmetric matrix with random entries in Armadillo:
```cpp
// Generate random N*N matrix
arma::mat A = arma::mat(N, N).randn();  

// Symmetrize the matrix by reflecting the upper triangle to lower triangle
A = arma::symmatu(A);  
```


### Problem 7
**a)** For a discretization of $\hat{x}$ with $n=10$ steps, solve Eq. {eq}`bb_eq_3` using your Jacobi code and make a plot of the three eigenvectors corresponding to the three lowest eigenvalues. The plot should show vector elements $v_i$ against the corresponding positions $\hat{x}_i$. 

Since we are effectively showing the solutions to a differential equation, your plot should also include the boundary points $(\hat{x}_0, v_0)$ and $(\hat{x}_n, v_n)$.

Plot the corresponding analytical eigenvectors (extended with the boundary points) in the same plot.

**b)** Make the same plot for discretization of $\hat{x}$ with $n=100$ steps.




----

## Code snippets

**A suggested code structure:** There are many ways of designing the code for this project. The three function declarations (and descriptions) below give a hint of one possible approach:

```cpp
// Determine the the max off-diagonal element of a symmetric matrix A
// - Saves the matrix element indicies to k and l 
// - Returns absolute value of A(k,l) as the function return value
double max_offdiag_symmetric(const arma::mat& A, int& k, int& l);

// Performs a single Jacobi rotation, to "rotate away"
// the off-diagonal element at A(k,l).
// - Assumes symmetric matrix, so we only consider k < l
// - Modifies the input matrices A and R
void jacobi_rotate(arma::mat& A, arma::mat& R, int k, int l);

// Jacobi method eigensolver:
// - Runs jacobo_rotate until max off-diagonal element < eps
// - Writes the eigenvalues as entries in the vector "eigenvalues"
// - Writes the eigenvectors as columns in the matrix "eigenvectors"
//   (The returned eigenvalues and eigenvectors are sorted using arma::sort_index)
// - Stops if it the number of iterations reaches "maxiter"
// - Writes the number of iterations to the integer "iterations"
// - Sets the bool reference "converged" to true if convergence was reached before hitting maxiter
void jacobi_eigensolver(const arma::mat& A, double eps, arma::vec& eigenvalues, arma::mat& eigenvectors, 
                        const int maxiter, int& iterations, bool& converged);
```

When such helper functions are in place and working, writing a main program for some specific task is typically not too much work. (Famous last words.) 

----


**Finding the max off-diagonal element:** Here is one possible sketch for the function `max_offdiag_symmetric` discussed above:

```cpp
// A function that finds the max off-diag element of a symmetric matrix A.
// - The matrix indices of the max element are returned by writing to the  
//   int references k and l (row and column, respectively)
// - The value of the max element A(k,l) is returned as the function
//   return value
double max_offdiag_symmetric(const arma::mat& A, int& k, int& l)
{
  // Get size of the matrix A. Use e.g. A.n_rows, see the Armadillo documentation

  // Possible consistency checks:
  // Check that A is square and larger than 1x1. Here you can for instance use A.is_square(), 
  // see the Armadillo documentation.
  // 
  // The standard function 'assert' from <assert.h> can be useful for quick checks like this 
  // during the code development phase. Use it like this: assert(some condition),
  // e.g assert(a==b). If the condition evaluates to false, the program is killed with 
  // an assertion error. More info: https://www.cplusplus.com/reference/cassert/assert/

  // Initialize references k and l to the first off-diagonal element of A

  // Initialize a double variable 'maxval' to A(k,l). We'll use this variable 
  // to keep track of the largest off-diag element.

  // Loop through all elements in the upper triangle of A (not including the diagonal)
  // When encountering a matrix element with larger absolute value than the current value of maxval,
  // update k, l and max accordingly.

  // Return maxval 
}
```

Note that this function has some inefficiencies: In an optimized program, you don't want this
function to always check that A is square and larger than 1x1 -- perhaps you don't want this 
function to check this at all, but rather just trust the input is is given from your main code.
But during development, it is often useful to first write code that is fairly self-contained and "safe" 
(makes it easier to debug), and then optimize it afterwards.

-----

**Helper functions for creating tridiagonal matrices:**  A standard task that you will often need is to 
create a tridiagonal matrix. Why not write a small helper function for doing precisely that? Here's an 
outline of such a function:

```cpp
// Create a tridiagonal matrix tridiag(a,d,e) of size n*n, 
// from scalar input a, d, and e. That is, create a matrix where
// - all n-1 elements on the subdiagonal have value a
// - all n elements on the diagonal have value d
// - all n-1 elements on the superdiagonal have value e
arma::mat create_tridiagonal(int n, double a, double d, double e)
{
  // Start from identity matrix
  arma::mat A = arma::mat(n, n, arma::fill::eye);

  // Fill the first row (row index 0), e.g.
  A(0,0) = d;
  A(0,1) = e;

  // Loop that fills rows 2 to n-1 (row indices 1 to n-2)

  // Fill last row (row index n-1)
  
  return A;
}
```

Again, there are ways to make this more efficient, e.g. by writing the diagonal elements
directly when we create the matrix, e.g. 

```cpp
// Start from identity matrix
arma::mat A = arma::mat(n, n, arma::fill::eye) * d;
```

But this function will anyway not be the computational bottleneck of your code, so you might as well 
keep the code more explicit if you find that easier to read/understand.

Once you have a function `create_tridiagonal`, you could easily add a function specialized to the symmetric case, 
that simply uses the more general function:

```cpp
// Create a symmetric tridiagonal matrix tridiag(a,d,a) of size n*n
// from scalar input a and d.
arma::mat create_symmetric_tridiagonal(int n, double a, double d)
{
  // Call create_tridiagonal and return the result
  return create_tridiagonal(n, a, d, a);
}
```

The above functions assume that all elements on a given sub-, super- or main diagonal are identical. In a more general case
you would need to pass in three vectors with the relevant matrix elements. Then you could have a set of three helper functions as sketched here:

```cpp
// Create tridiagonal matrix from vectors.
// - lower diagonal: vector a, lenght n-1
// - main diagonal:  vector d, lenght n
// - upper diagonal: vector e, lenght n-1
arma::mat create_tridiagonal(const arma::vec& a, const arma::vec& d, const arma::vec& e)
{
  // Start from identity matrix
  arma::mat A = arma::mat(n, n, fill::eye);

  // Fill first row (row index 0)

  // Loop that fills rows 2 to n-1 (row indices 1 to n-2)
  
  // Fill last row (row index n-1)

  return A;
}


// Create a tridiagonal matrix tridiag(a,d,e) of size n*n
// from scalar input a, d and e
arma::mat create_tridiagonal(int n, double a, double d, double e)
{
  arma::vec a_vec = arma::vec(n-1, arma::fill::ones) * a;
  arma::vec d_vec = arma::vec(n, arma::fill::ones) * d;
  arma::vec e_vec = arma::vec(n-1, arma::fill::ones) * e;

  // Call the vector version of this function and return the result
  return create_tridiagonal(a_vec, d_vec, e_vec);
}


// Create a symmetric tridiagonal matrix tridiag(a,d,a) of size n*n
// from scalar input a and d.
arma::mat create_symmetric_tridiagonal(int n, double a, double d)
{
  // Call create_tridiagonal and return the result
  return create_tridiagonal(n, a, d, a);
}
```

Note:

- Having one function call another like this can help us avoid duplicating 
  what would have been almost identical code in multiple functions.

- In C++ you can have multiple functions with the same function name (here `create_tridiagonal`)
  as long as the set of input arguments are different. This is known as **function overloading**.

----

**Watch this space for more code examples...**
 --></div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./book/projects"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="project1.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Project 1</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="project3.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Project 3</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By the FYS3150 teaching team<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>